<% to_learn_today_count = user_flashcards.where("user_deck_id = ? AND learnt IS ? AND due_to_learn <= ? AND ignore = ?", user_deck.id, nil, DateTime.now.utc.end_of_day, false).count %>
<% learnt_today_count = user_flashcards.where("user_deck_id = ? AND learnt > ? AND learnt <= ? AND ignore = ?", user_deck.id, DateTime.now.utc.beginning_of_day,  Time.now, false).count %>
<% total_learn_today_count = learnt_today_count + to_learn_today_count %>
<% if learnt_today_count > 0 && total_learn_today_count > 0 %>
  <% today_learn_progress_percentage = learnt_today_count.to_f / total_learn_today_count.to_f * 100 %>
<% else %>
  <% today_learn_progress_percentage = 0 %>
<% end %>

<div class="progress" id="today-learn-progress-bar"  data-bs-toggle="popover" data-bs-trigger="focus" title="<%= learnt_today_count %> / <%= total_learn_today_count %>" data-bs-content="And here's some amazing content. It's very engaging. Right?">
  <% if today_learn_progress_percentage == 100 %>
    <div class="progress-bar bg-success" role="progressbar" style="width: <%= "#{today_learn_progress_percentage}%" %>" aria-valuenow="6" aria-valuemin="0" aria-valuemax="10"></div>
  <% else %>
    <div class="progress-bar bg-warning" role="progressbar" style="width: <%= "#{today_learn_progress_percentage}%" %>" aria-valuenow="6" aria-valuemin="0" aria-valuemax="10"></div>
  <% end %>
</div>
