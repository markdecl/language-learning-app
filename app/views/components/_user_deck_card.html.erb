<%# <div class="card mb-3" style="max-width: 540px;"> %>

<% deck = @decks.find(user_deck.deck_id) %>
<% user_deck_flashcards = user_flashcards.where(user_deck_id: user_deck.id) %>
<% user_deck_flashcards_count = user_deck_flashcards.count %>
<% user_deck_flashcards_ignored_count = user_flashcards.where("user_deck_id = ? AND ignore = ?", user_deck.id, true).count %>

<% user_deck_flashcards_learnt_count = user_flashcards.where("user_deck_id = ? AND learnt IS NOT ? AND ignore = ?", user_deck.id, nil, false).count %>
<% user_deck_flashcards_to_learn_count = user_flashcards.where("user_deck_id = ? AND learnt IS ? AND ignore = ?", user_deck.id, nil, false).count %>

<%# current_user_deck_flashcards_per_day = user_deck_flashcards.where("due_to_learn > ? AND due_to_learn < ?", DateTime.now.utc.beginning_of_day, DateTime.now.utc.end_of_day).count %>

<% to_learn_today_count = user_flashcards.where("user_deck_id = ? AND learnt IS ? AND due_to_learn <= ? AND ignore = ?", user_deck.id, nil, DateTime.now.utc.end_of_day, false).count %>

<% to_review_today_count = user_flashcards.where("user_deck_id = ? AND next_review <= ? AND ignore = ?", user_deck.id, DateTime.now.utc.end_of_day, false).count %>

<%= render 'components/get_learning_schedule_modal', user_deck: user_deck, user_deck_flashcards_to_learn_count: user_deck_flashcards_to_learn_count %>

<%= render 'components/delete_user_deck_modal', user_deck: user_deck %>

<div class="card shadow m-3 user_deck_card">
<%# <div class="card m-3 user_deck_card"> %>
  <div class="row g-0">
    <div class="col-md-4 d-none d-md-block"> <%# d-none d-md-block hides this div on screen sizes smaller than md %>
      <%# <img src="images/<%= deck.name.downcase %><%#.jpg" class="img-fluid rounded-start" alt="..."> %>
      <%= image_tag "#{deck.name.downcase}.jpg", class: "card-img-top img-fluid rounded-start user_deck_card_img", style: "height: 333px;object-fit:cover;" %>
    </div>
    <div class="col-md-8">
      <div class="card-body">

        <ul class="list-group list-group-flush">

          <li class="list-group-item">

            <%= link_to user_deck_path(user_deck.id, section: 0), method: :get, class: 'card-title text-dark text-decoration-none' do %>
              <h3><%= deck.name %></h3>
            <% end %>

            <% if user_deck_flashcards_count == 1 %>
              <p class="card-text"><%= user_deck_flashcards_count %> card</p>
            <% else %>
              <p class="card-text"><%= user_deck_flashcards_count %> cards</p>
            <% end %>

            <%#= link_to user_deck_open_delete_modal_path(user_deck), :method => :patch do %>
              <%# <i class="fa-solid fa-trash-can user_deck_card_delete_icon text-secondary"></i>
            <%# end %>

            <div id="user_deck_card_dropdown" class="dropdown" style="z-index: 1;">
              <button class="btn btn-light dropdown-toggle" type="button" id="dropdownMenu2" data-bs-toggle="dropdown" aria-expanded="false" style="z-index: 1;">
                Options
              </button>
              <ul class="dropdown-menu dropdown-menu-end text-end" aria-labelledby="dropdownMenu2">
                <li><%= link_to "View cards", user_deck_path(user_deck.id, section: 0), method: :get, class: "dropdown-item" %></li>
                <%# <li><%= link_to "Change learning schedule", get_learning_schedule_path(user_deck.id), method: :get, class: "dropdown-item" %> <%# </li> %>
                <div data-bs-toggle="modal" data-bs-target="#GetLearningScheduleModal<%= user_deck.id %>" class="dropdown-item">
                  Change learning schedule
                </div>
                <li><hr class="dropdown-divider"></li>
                <!-- Button trigger confirm delete deck modal -->
                <li>
                  <div data-bs-toggle="modal" data-bs-target="#ConfirmDeleteDeckModal<%= user_deck.id %>" class="dropdown-item text-danger">
                    <i class="fa-solid fa-trash-can user_deck_card_delete_icon text-secondary"></i>
                    Delete deck
                  </div>
                </li>
              </ul>
            </div>

          </li>

          <li class="list-group-item d-flex flex-column">

            <div class="mb-1">
              Deck progress:
              <%# <%= user_deck_flashcards_learnt_count / user_deck_flashcards_count * 100 %>
              <%# <%= (user_deck_flashcards_learnt_count / user_deck_flashcards_count) * 100  %>
              <%= user_deck_flashcards_learnt_count + user_deck_flashcards_ignored_count %> / <%= user_deck_flashcards_count %>

              <% if user_deck_flashcards_learnt_count > 0 && user_deck_flashcards_count > 0 %>
                <% deck_progress_percentage = (user_deck_flashcards_learnt_count.to_f + user_deck_flashcards_ignored_count.to_f) / user_deck_flashcards_count.to_f * 100 %>
              <% else %>
                <% deck_progress_percentage = 0 %>
              <% end %>
              <div class="progress">
                <%# <div class="progress-bar" role="progressbar" style="width: 50%" aria-valuenow="<%= user_deck_flashcards_learnt_count" aria-valuemin="0" aria-valuemax="<%= user_deck_flashcards_count"></div> %>
                <% if deck_progress_percentage == 100 %>
                  <div class="progress-bar bg-success" role="progressbar" style="width: <%= "#{deck_progress_percentage}%" %>" aria-valuenow= "<%= user_deck_flashcards_learnt_count + user_deck_flashcards_ignored_count %>" aria-valuemin="0" aria-valuemax="<%= user_deck_flashcards_count %>"></div>
                <% else %>
                  <div class="progress-bar bg-primary mb-3" role="progressbar" style="width: <%= "#{deck_progress_percentage}%" %>" aria-valuenow= "<%= user_deck_flashcards_learnt_count + user_deck_flashcards_ignored_count %>" aria-valuemin="0" aria-valuemax="<%= user_deck_flashcards_count %>"></div>
                <% end %>
              </div>
              <%# <%= user_deck_flashcards_learnt_count / <%= user_deck_flashcards_count %>
              <%# <br> %>
            </div>

            <div class="mb-1">
              Daily learning goal:
              <%# learnt_today_count = user_flashcards.where("user_deck_id = ? AND learnt <= ?", user_deck.id, Time.now).count %>
              <%#= learnt_today_count %>
              <%# to_learn_today_count = user_flashcards.where("user_deck_id = ? AND learnt IS ? AND due_to_learn <= ? AND ignore = ?", user_deck.id, nil, Time.now.to_date.midnight, false).count %>
              <%# <%= to_learn_today_count %>
              <%# Daily learn progress bar %>
              <%= render 'components/today_learn_progress_bar', user_deck: user_deck, user_flashcards: user_flashcards %>
              <%# <div class="progress"> /
                <div class="progress-bar" role="progressbar" style="width: 50%" aria-valuenow="6" aria-valuemin="0" aria-valuemax="10"></div>
              </div>
              %>
            </div>

            <div class="mb-1">
              <%# Daily review progress bar %>
              Daily review goal:

              <%= render 'components/today_review_progress_bar', user_deck: user_deck, user_flashcards: user_flashcards %>

            </div>
          </li>
        </ul>

        <%# <p class="card-text"><small class="text-muted"></small></p> %>

        <div class="card-footer d-flex justify-content-between">

          <%# z-index is set to 1 for the buttons to 'raise' them above the Bootstrap stretched link %>

          <%# <div class="btn-group" role="group">

            <%# <%= link_to "Show", user_deck_path(user_deck.id) %>

            <%# <%= link_to "Learn", user_deck_learn_path(user_deck.id) %>
            <%= link_to user_deck_learn_path(user_deck.id), method: :get , id: 'learn-button', class: "btn btn-warning", style: "width:49%;z-index: 1;" do %>
              Learn <%= content_tag :span, to_learn_today_count, class: 'badge bg-dark' %>
            <% end %>
            <%# <button type="button" class="btn btn-warning">Learn</button> %>

            <%# <%= link_to "Review", user_deck_path(user_deck.id) %>
            <%# <%= link_to "Review", user_deck_review_path(user_deck.id) %>
            <% if to_review_today_count > 0 %>
              <%= link_to user_deck_review_path(user_deck, answer_checked: false, answer_correct: false), method: :get, id: 'review-button', class: 'btn btn-danger', style: "width:49%;z-index: 1;", data: {toggle: :tab} do %>
                Review <%= content_tag :span, to_review_today_count, class: 'badge bg-dark' %>
              <% end %>
            <% else %>
              <%= link_to user_deck_review_path(user_deck, answer_checked: false, answer_correct: false), method: :get, id: 'review-button', class: 'btn btn-danger disabled', style: "width:49%;z-index: 1;", data: {toggle: :tab} do %>
                Review <%= content_tag :span, to_review_today_count, class: 'badge bg-dark' %>
              <% end %>
            <% end %>

            <%# helper method to return count of review pile %>
            <%# <%= button_to "Review", user_deck_review_path(user_deck.id) %>
            <%# <button type="button" class="btn btn-danger">Review</button> %>
            <%# <button type="button" class="btn btn-primary" data-toggle="modal" data-target="_user_deck_delete_modal">
              Delete
            </button> %>

            <%#= link_to 'Delete', user_deck_path(user_deck), :method => :delete, data: { confirm: "Are you sure you want to delete this deck? This action cannot be undone." }, :class => "btn btn-secondary w-25" %>

          <%# </div> %>

        </div>
      </div>
    </div>
  </div>
</div>
